# 后端项目部署服务器

[TOC]

## 连接服务器

使用xshell和xftp软件。其中**xshell**是一个终端模拟器，**xftp**是一个文件传输工具。前者用来控制服务器上相关操作，后者用于将本地文件上传服务器。

![image-20230917210332356](C:\Users\wyx20\AppData\Roaming\Typora\typora-user-images\image-20230917210332356.png)

注意端口号选择默认的22，用户名是root，密码为之前设置的密码（iGEM2023)。

![image-20230917210450977](C:\Users\wyx20\AppData\Roaming\Typora\typora-user-images\image-20230917210450977.png)

连接成功后,会显示对应界面。

xftp:

![image-20230917210525396](C:\Users\wyx20\AppData\Roaming\Typora\typora-user-images\image-20230917210525396.png)

xshell:

![image-20230917210613169](C:\Users\wyx20\AppData\Roaming\Typora\typora-user-images\image-20230917210613169.png)

## 将本地的数据库部署到服务器端

### 服务器端新建数据库

安装mysql服务。

```shell
yum install mariadb-server -y        #安装mysql服务端
```

启动mariadb服务。

```shell
systemctl start mariadb        #启动mariadb
systemctl stop mariadb         #停止
systemctl enable mariadb       #开机启动
```

如果遇到错误可能需要修改编辑MariaDB配置文件，通常位于 `/etc/my.cnf` 或 `/etc/mysql/my.cnf`。

登录mysql数据库

```shell
mysql -u root -p         #登录，不用输入密码直接回车
```

创建新数据库：

```sql
CREATE DATABASE casleuth DEFAULT CHARSET utf8mb4 COLLATE utf8mb4_general_ci;
```

这里的casleuth为数据库名称，注意这里的**字符集**和**校对规则**需要和本地的数据库相对应。

创建新用户：

```sql
insert into mysql.user(user,host,password) values('用户名','%','password('密码'));
```

%为通配符，表示对所有IP均适用。

要给该用户赋予对数据库的所有权限：

```mysql
GRANT ALL PRIVILEGES ON casleuth.* TO '用户名'@'主机名' IDENTIFIED BY '密码';
```

- `'用户名'` 应该替换为你要授权的用户名。
- `'主机名'` 应该替换为允许连接到数据库的主机名。如果你想允许从任何主机连接，可以使用通配符 `%`。
- `'密码'` 应该替换为该用户的密码。如果用户已经存在，可以省略 `IDENTIFIED BY '密码'`。

完成授权后，确保刷新权限以使更改生效:

```sql
FLUSH PRIVILEGES;
```

### 连接服务器端数据库

首先，检查当前服务器的防火墙规则，以了解系统当前的端口状态。

```shell
sudo firewall-cmd --list-all
```

要确保需要使用的端口已经全部打开：![image-20230917214216776](C:\Users\wyx20\AppData\Roaming\Typora\typora-user-images\image-20230917214216776.png)

如果未打开，需要开放端口（例如，5555 端口），使用以下命令：

```shell
sudo firewall-cmd --zone=public --add-port=5555/tcp --permanent
```

这将在公共区域（你可以根据需要更改区域）开放 TCP 5555 端口。`--permanent` 标志将永久保存规则，以便在系统重新启动后保留。

开放端口后，需要立即重新加载防火墙规则以应用更改：

```shell
sudo firewall-cmd --reload
```

同时，还要进入到腾讯云服务器的控制台，设置防火墙，点击添加规则新增放通上面所需要开放的5555端口：

![image-20230917215953723](C:\Users\wyx20\AppData\Roaming\Typora\typora-user-images\image-20230917215953723.png)

打开Navicat数据库管理工具，新建连接。注意这里的用户名密码就是刚才在服务器上新建的用户和密码。

![image-20230917221044308](C:\Users\wyx20\AppData\Roaming\Typora\typora-user-images\image-20230917221044308.png)

### 将本地数据库转入服务器端数据库

打开本地连接的数据库，选择转储SQL文件-结构和数据，之后选择刚才连接的服务器端数据库运行SQL文件，即可生成对应的数据库表。

![image-20230917213152130](C:\Users\wyx20\AppData\Roaming\Typora\typora-user-images\image-20230917213152130.png)



![image-20230917221335840](C:\Users\wyx20\AppData\Roaming\Typora\typora-user-images\image-20230917221335840.png)

## 将本地的Springboot项目部署到服务器

首先，检查本地项目能否在localhost下正常运行，测试接口成功后点击Maven。先选择clean清理项目，然后点击package将项目打包成jar可执行文件。

![image-20230917221532694](C:\Users\wyx20\AppData\Roaming\Typora\typora-user-images\image-20230917221532694.png)

打包后的jar文件会生成在项目目录下的target文件夹里。

![image-20230917221618852](C:\Users\wyx20\AppData\Roaming\Typora\typora-user-images\image-20230917221618852.png)

在xshell终端输入命令 `java -version`检查服务器是否安装java。

若未安装，使用包管理器来安装 Java。

```shell
sudo yum install java-17-openjdk-devel
```

安装完成后，验证java版本：

```shell
java -version
```

![image-20230917223652032](C:\Users\wyx20\AppData\Roaming\Typora\typora-user-images\image-20230917223652032.png)

利用xftp将本地刚才生成的jar文件传输到服务器上。

使用 `cd`命令转移到对应文件夹，使用 `java -jar wyx0917.jar`试运行该jar文件（该种运行方法会在关闭连接后失效)。

注意，运行后使用接口必须先开放对应端口，方法同上面一样，服务器端和腾讯云控制面板都需要进行开放操作。

使用 `ps -ef | grep java`命令可以查看正在服务器上运行的java进程pid。

使用 `kill -9 pid`可以杀死对应pid的进程。

使用 `nohup java -jar wyx0917.jar >output 2>&1 &`可以让对应的jar文件在服务器上一直运行，即使关闭连接也可以一直运行。

## 接口使用

http://43.133.192.56:5555/virus/detail?virus_id=1111  使用格式前面是ip+端口号，后面是接口路径和参数。

对应的swagger文档：http://43.133.192.56:5555/swagger-ui/index.html

